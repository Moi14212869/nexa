<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>IA avec apprentissage s√©curis√©</title>

  <!-- brain.js -->
  <script src="https://cdn.jsdelivr.net/npm/brain.js@2.0.0-beta.23/dist/brain-browser.min.js"></script>

  <style>
    body {
      background: #0f0f0f;
      color: white;
      font-family: Arial;
    }
    .chat {
      width: 500px;
      margin: 30px auto;
      background: #1c1c1c;
      padding: 15px;
      border-radius: 10px;
      position: relative;
    }
    #box {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #333;
      padding: 10px;
      margin-bottom: 10px;
    }
    .user { color: #4aa3ff; text-align: right; }
    .bot { color: #7CFC98; text-align: left; }

    input {
      width: 75%;
      padding: 6px;
    }
    button {
      padding: 6px 10px;
      background: #4aa3ff;
      border: none;
      color: white;
      cursor: pointer;
    }

    /* MODAL */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="chat">
  <h2>üß† IA avec apprentissage prot√©g√©</h2>

  <button onclick="ouvrirLogin()">üîê Connexion admin</button>

  <div id="box"></div>

  <input id="input" placeholder="Parle √† l'IA..."
         onkeydown="if(event.key==='Enter') envoyer()">
  <button onclick="envoyer()">Envoyer</button>
</div>

<!-- MODAL LOGIN -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <h3>Connexion admin</h3>
    <input id="passwordInput" type="password" placeholder="Mot de passe">
    <br><br>
    <button onclick="verifierLogin()">Connexion</button>
    <button onclick="fermerLogin()">Annuler</button>
    <p id="loginMsg"></p>
  </div>
</div>

<script>
/********************
 * ‚úÖ S√âCURIT√â CHARGEMENT
 ********************/
if (typeof brain === "undefined") {
  alert("Erreur : brain.js non charg√©");
}

/********************
 * üß† R√âSEAU
 ********************/
const net = new brain.NeuralNetwork({ hiddenLayers: [10, 10] });

/********************
 * üìö DONN√âES
 ********************/
let intents = JSON.parse(localStorage.getItem("intents")) || {
  salutation: ["bonjour", "salut"],
  question: ["comment √ßa marche"],
  emotion: ["je suis content", "je suis triste"]
};

/********************
 * üî¢ VECTEUR
 ********************/
function vectoriser(txt) {
  let v = {};
  txt.toLowerCase().split(/\W+/).forEach(m => {
    if (m) v[m] = (v[m] || 0) + 1;
  });
  return v;
}

/********************
 * üéì ENTRA√éNEMENT
 ********************/
function entrainer() {
  let data = [];
  for (let i in intents) {
    intents[i].forEach(p => {
      data.push({ input: vectoriser(p), output: { [i]: 1 } });
    });
  }
  net.train(data, { iterations: 2000, errorThresh: 0.005 });
}

entrainer(); // ‚úÖ APPEL APR√àS net

/********************
 * üîê ADMIN
 ********************/
let adminMode = false;

/********************
 * ü§ñ IA
 ********************/
function IA(message) {

  if (message.startsWith("/learn ") && !adminMode) {
    return "‚õî Mode admin requis";
  }

  if (adminMode && message.startsWith("/learn ")) {
    const parts = message.replace("/learn ", "").split("|");
    if (parts.length !== 2) return "Format : /learn intention | phrase";

    const intent = parts[0].trim();
    const phrase = parts[1].trim();

    intents[intent] = intents[intent] || [];
    intents[intent].push(phrase);

    localStorage.setItem("intents", JSON.stringify(intents));
    entrainer();

    return `üß† Appris : ${phrase}`;
  }

  const r = net.run(vectoriser(message));

  if (!r || Object.keys(r).length === 0) {
    return "ü§î Je ne comprends pas encore.";
  }

  const intent = Object.keys(r).reduce((a,b) => r[a] > r[b] ? a : b);

  if (intent === "salutation") return "Salut üëã";
  if (intent === "question") return "Bonne question ü§î";
  if (intent === "emotion") return "Je ressens une √©motion üíô";

  return "Intention reconnue, r√©ponse manquante.";
}

/********************
 * üí¨ UI
 ********************/
function envoyer() {
  const input = document.getElementById("input");
  const msg = input.value.trim();
  if (!msg) return;

  afficher(msg, "user");
  input.value = "";

  setTimeout(() => afficher(IA(msg), "bot"), 300);
}

function afficher(txt, cls) {
  const box = document.getElementById("box");
  const div = document.createElement("div");
  div.className = cls;
  div.textContent = txt;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}
</script>


</body>
</html>
